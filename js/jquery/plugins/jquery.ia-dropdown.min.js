!function(t){var e=function(){return{init:function(e,i){this.cache={},this.children=[],this.options=t.extend({exclusions:!1,enableHtml:!1},i),this.$element=t(e),this.$label=t("#"+this.options.label),this.$value=t('input[name="'+this.options.valueHolder+'"]'),this.onChange=this.options.onChange||null;var n=this;if(this.$element.on("change",function(){n.fnHandlerOnChange(t(this))}),this.$element.data("children")){this.children=String(this.$element.data("children")).split(",");var s=this.children.shift();this.$element.val(s).trigger("change")}return this},updateLabel:function(){var e=[];t(this.options.selector+' option:selected:not([value=""])').each(function(){e.push(t(this).text())}),this.$label.val(e.length?e.join(" > "):_t("_not_selected_"))},addDropdown:function(e,i,n){if(e&&e.length){var s=this.options.selector.split(".");s.shift();var h=t("<option>").val("").text(_t("_select_")),l=t("<select>").addClass(s.join()).append(h),a=this.options.enableHtml;t.each(e,function(e,i){h=t("<option>").val(i.id),a?h.html(i.title):h.text(i.title),i.id==n&&h.prop("selected",!0),1==i.locked&&h.prop("disabled",!0),l.append(h)}),i.after(l);var o=this;l.on("change",function(){o.fnHandlerOnChange(t(this))}),n&&l.trigger("change")}},fnHandlerOnChange:function(e){var i=e.val();if(i){e.nextAll().remove();var n=0;if(this.children&&this.children.length>0&&(n=this.children.shift()),this.cache[i])this.cache[i]!==!0&&this.addDropdown(this.cache[i],e,n);else{var s=t("<img>").attr({"class":"spinner",src:intelli.config.ia_url+"templates/common/img/preloader.gif"}).insertAfter(e),h=this,l={pid:i};this.options.exclusions&&(l.id=this.$element.data("id")),t.getJSON(this.options.url+"?fn=?",l,function(t){s.remove(),h.cache[i]=!0,t&&t.length>0&&(h.cache[i]=t,h.addDropdown(t,e,n))})}}else{var a=e.prev();a.length?(i=a.val(),a.nextAll().remove()):t(this.options.selector).not(":first").remove()}this.$value.val(i),this.onChange&&this.onChange(i),this.$label.length&&this.updateLabel()}}};t.fn.iaDropdown=function(i){return this.length?(i.selector=this.selector,this.each(function(){var n=new e;n.init(this,i),t.data(this,"iadropdown",n)})):void 0}}(jQuery);